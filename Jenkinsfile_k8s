@Library('pipeline-library@pull/400/head') _

parallel(
  failFast: false,
  'maven-jdk8': {
     buildDockerAndPublishImage('inbound-agent-maven:jdk8', [
      dockerfile: 'maven/jdk8/Dockerfile',
      automaticSemanticVersioning: true,
      includeStageNameInTag: true,
    ])
  },
  'maven-jdk8-nanoserver': {
     buildDockerAndPublishImage('inbound-agent-maven:jdk8-nanoserver', [
      dockerfile: 'maven/jdk8/Dockerfile.nanoserver',
      agentLabels: 'windows',
      platform: 'windows/amd64',
      automaticSemanticVersioning: true,
      includeStageNameInTag: true,
    ])
  },
  'maven-jdk11': {
     buildDockerAndPublishImage('inbound-agent-maven:jdk11', [
      dockerfile: 'maven/jdk11/Dockerfile',
      automaticSemanticVersioning: true,
      includeStageNameInTag: true,
    ])
  },
  'maven-jdk11-nanoserver': {
     buildDockerAndPublishImage('inbound-agent-maven:jdk11-nanoserver', [
      dockerfile: 'maven/jdk11/Dockerfile.nanoserver',
      agentLabels: 'windows',
      platform: 'windows/amd64',
      automaticSemanticVersioning: true,
      includeStageNameInTag: true,
    ])
  },
  'maven-jdk17': {
     buildDockerAndPublishImage('inbound-agent-maven:jdk17', [
      dockerfile: 'maven/jdk17/Dockerfile',
      automaticSemanticVersioning: true,
      includeStageNameInTag: true,
    ])
  },
  'jdk11-windowsservercore-1809': {
     buildDockerAndPublishImage('inbound-agent:jdk11-windowsservercore-1809', [
      dockerfile: 'base/jdk11/Dockerfile.windowsservercore-1809',
      agentLabels: 'windows',
      platform: 'windows/amd64',
      automaticSemanticVersioning: true,
      includeStageNameInTag: true,
    ])
  },
  'node': {
     buildDockerAndPublishImage('inbound-agent-node', [
      dockerfile: 'node/Dockerfile',
      automaticSemanticVersioning: true,
      includeStageNameInTag: true,
    ])
  },
  'ruby': {
     buildDockerAndPublishImage('inbound-agent-ruby', [
      dockerfile: 'ruby/Dockerfile',
      automaticSemanticVersioning: true,
      includeStageNameInTag: true,
    ])
  },
  'updatecli': {
    updatecli(action: 'diff')
    if (env.BRANCH_IS_PRIMARY) {
      updatecli(action: 'apply', cronTriggerExpression: '@weekly')
    }
  },
)
